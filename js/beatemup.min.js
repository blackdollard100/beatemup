function Game(){var e=this;e.started=false;e.ended=false;e.construct=function(){images=new AssetManager(config.images);sounds=new AssetManager(config.sounds);e.renderer=new Renderer(config.arena.width,config.arena.height);e.user=new Fighter({x:config.fighter.x,y:config.fighter.y},images.get("user"));e.computer=new Fighter({x:config.arena.width-config.fighter.width-config.fighter.x,y:config.fighter.y},images.get("computer"));e.user.setOpponent(e.computer);e.computer.setOpponent(e.user);e.start();e.rendering=window.setInterval(e.render,1e3/config.frameRate)};e.render=function(){e.renderer.render();e.user.render();e.computer.render()};e.start=function(){if(e.started){return}sounds.get("fight").play();e.renderer.addImages(["arena","computer","user","computerEnergyBar","userEnergyBar","computerEnergy","userEnergy","computerName","userName","fight"]);e.constructControllers();e.startUpdating();window.setTimeout(function(){e.renderer.removeImage("fight")},config.startDelay);e.started=true};e.constructControllers=function(){e.keyboardController=new KeyboardController(e.user);e.timeController=new TimeController(e.computer)};e.startUpdating=function(){e.updating=window.setInterval(e.update,1e3/config.frameRate)};e.update=function(){e.updateEnergy();e.keyboardController.update();e.timeController.update()};e.updateEnergy=function(){images.get("userEnergy").width=e.user.energy/100*config.energy.width;images.get("computerEnergy").width=e.computer.energy/100*config.energy.width;images.get("computerEnergy").x=config.arena.width-config.energy.width-config.energy.x+(100-e.computer.energy)/100*config.energy.width;if(e.user.energy==0||e.computer.energy==0){e.end()}};e.end=function(){if(e.ended){return}e.determineWinner();e.loser.lose();e.destructControllers();e.stopUpdating();window.setTimeout(function(){var t=e.winner==e.user?"userWins":"computerWins";sounds.get(t).play();e.renderer.addImage(t);e.winner.win()},config.endDelay);e.ended=true};e.destructControllers=function(){e.keyboardController.destruct();e.timeController.destruct()};e.stopUpdating=function(){window.clearInterval(e.updating)};e.determineWinner=function(){if(e.computer.energy==0){e.winner=e.user;e.loser=e.computer}else if(e.user.energy==0){e.winner=e.computer;e.loser=e.user}};e.construct()}function AssetManager(e){var t=this;t.objects=e;t.assets=[];t.construct=function(){t.load()};t.load=function(){for(var e in t.objects){var n=t.objects[e];var r=n.fileName.split(".").pop();switch(r){case"gif":case"jpg":case"png":var i=new ImageAsset(n);break;case"mp3":case"wav":var i=new SoundAsset(n);break;default:var i=null}t.assets[e]=i}};t.get=function(e){return t.assets[e]};t.construct()}function ImageAsset(e){var t=this;t.object=e;t.construct=function(){t.image=new Image;t.image.src=t.object.fileName;t.width=t.object.width;t.height=t.object.height;t.x=t.object.x;t.y=t.object.y;t.swidth=t.object.width;t.sheight=t.object.height;t.sx=0;t.sy=0;t.frames=t.object.frames!==undefined?t.object.frames:null};t.construct()}function SoundAsset(e){var t=this;t.object=e;t.construct=function(){t.sound=new Audio;t.sound.src=t.object.fileName};t.play=function(){t.sound.play()};t.construct()}function Renderer(e,t){var n=this;n.canvasWidth=e;n.canvasHeight=t;n.images=[];n.construct=function(){n.initializeCanvas()};n.initializeCanvas=function(){var e=document.createElement("canvas");e.width=n.canvasWidth;e.height=n.canvasHeight;document.getElementById("body").appendChild(e);n.canvas=e.getContext("2d")};n.addImages=function(e){for(var t=0;t<e.length;t++){n.addImage(e[t])}};n.addImage=function(e){n.images[e]=e};n.removeImages=function(e){for(var t=0;t<e.length;t++){n.removeImage(e[t])}};n.removeImage=function(e){delete n.images[e]};n.render=function(){for(var e in n.images){var t=images.get(e);n.canvas.drawImage(t.image,t.sx,t.sy,t.width,t.height,t.x,t.y,t.width,t.height)}};n.construct()}function Sprite(e,t){var n=this;n.image=e;n.defaultFrames=t;n.frames=null;n.resetFrames=true;n.loopFrames=true;n.construct=function(){n.reset()};n.changeFrames=function(e,t,r){n.frames=e;n.resetFrames=t;n.loopFrames=r};n.reset=function(){if(n.loopFrames){n.frame=0}else{n.frame=n.frames.length-1}if(n.resetFrames){n.frames=n.defaultFrames}};n.animate=function(){if(n.frames[n.frame]===undefined){n.frame=0}n.image.sx=n.frames[n.frame].x;n.image.sy=n.frames[n.frame].y;n.frame++;if(n.frame==n.frames.length){n.reset()}};n.move=function(e){n.image.x=e.x;n.image.y=e.y};n.construct()}function Fighter(e,t){var n=this;n.position=e;n.image=t;n.states={idle:0,walkLeft:1,walkRight:2,jump:3,punch:4,kick:5,getHit:6,win:7,lose:8};n.energy=100;n.construct=function(){n.sprite=new Sprite(n.image,n.image.frames.idle);n.idle()};n.setOpponent=function(e){n.opponent=e};n.render=function(){n.sprite.animate();n.sprite.move(n.position)};n.setPosition=function(e,t){n.position.x=e;n.position.y=t};n.setState=function(e,t){if(t){n.sprite.reset()}switch(e){case n.states.idle:n.sprite.changeFrames(n.image.frames.idle,false,true);break;case n.states.walkLeft:n.sprite.changeFrames(n.image.frames.walkLeft,false,true);break;case n.states.walkRight:n.sprite.changeFrames(n.image.frames.walkRight,false,true);break;case n.states.punch:n.sprite.changeFrames(n.image.frames.punch,true,true);break;case n.states.kick:n.sprite.changeFrames(n.image.frames.kick,true,true);break;case n.states.getHit:n.sprite.changeFrames(n.image.frames.getHit,true,true);break;case n.states.win:n.sprite.changeFrames(n.image.frames.win,false,false);break;case n.states.lose:n.sprite.changeFrames(n.image.frames.lose,false,false);break}};n.idle=function(){n.setState(n.states.idle,true)};n.walkLeft=function(){n.setState(n.states.walkLeft,false);if(n.position.x<n.opponent.position.x){n.setPosition(Math.max(config.fighter.x,n.position.x-config.fighter.stepLength),n.position.y)}else{n.setPosition(Math.max(n.opponent.position.x+config.fighter.bodyWidth*config.fighter.vulnerability,n.position.x-config.fighter.stepLength),n.position.y)}};n.walkRight=function(){n.setState(n.states.walkRight,false);if(n.position.x<n.opponent.position.x){n.setPosition(Math.min(n.opponent.position.x-config.fighter.bodyWidth*config.fighter.vulnerability,n.position.x+config.fighter.stepLength),n.position.y)}else{n.setPosition(Math.min(n.position.x+config.fighter.stepLength,config.arena.width-config.fighter.bodyWidth),n.position.y)}};n.punch=function(){n.setState(n.states.punch,true);if(n.position.x<n.opponent.position.x&&n.opponent.position.x-n.position.x<config.fighter.bodyWidth||n.opponent.position.x<n.position.x&&n.position.x-n.opponent.position.x<config.fighter.bodyWidth){n.opponent.getHit();sounds.get("getPunched").play()}};n.kick=function(){n.setState(n.states.kick,true);if(n.position.x<n.opponent.position.x&&n.opponent.position.x-n.position.x<config.fighter.bodyWidth||n.opponent.position.x<n.position.x&&n.position.x-n.opponent.position.x<config.fighter.bodyWidth){n.opponent.getHit();sounds.get("getKicked").play()}};n.getHit=function(){n.setState(n.states.getHit,true);sounds.get("moan"+Math.round(Math.random()+1)).play();n.energy=Math.max(0,n.energy-config.fighter.damage)};n.win=function(){n.setState(n.states.win,true)};n.lose=function(){n.setState(n.states.lose,true)};n.construct()}function KeyboardController(e){var t=this;t.fighter=e;t.states={walkLeft:false,walkRight:false,jump:false};t.construct=function(){window.addEventListener("keydown",t.onKeyDown);window.addEventListener("keyup",t.onKeyUp)};t.onKeyDown=function(e){switch(e.which){case config.keys.walkLeft:t.states.walkLeft=true;break;case config.keys.walkRight:t.states.walkRight=true;break}};t.onKeyUp=function(e){switch(e.which){case config.keys.punch:t.fighter.punch();break;case config.keys.kick:t.fighter.kick();break;case config.keys.walkLeft:t.states.walkLeft=false;t.fighter.idle();break;case config.keys.walkRight:t.states.walkRight=false;t.fighter.idle();break}};t.update=function(){if(t.states.walkLeft){t.fighter.walkLeft()}if(t.states.walkRight){t.fighter.walkRight()}};t.destruct=function(){t.states.walkLeft=false;t.states.walkRight=false;t.states.jump=false;window.removeEventListener("keydown",t.onKeyDown);window.removeEventListener("keyup",t.onKeyUp)};t.construct()}function TimeController(e){var t=this;t.fighter=e;t.states={walkLeft:false,walkRight:false,jump:false};t.construct=function(){t.fighting=window.setInterval(t.performRandomAction,1e3/config.difficulty)};t.performRandomAction=function(){var e=Math.random();if(Math.floor(e*4)>0){t.states.walkLeft=true}else if(Math.floor(e*2)>0){t.states.walkRight=true}else{t.states.walkLeft=false;t.states.walkRight=false;t.fighter.idle()}if(t.fighter.opponent.position.x>=t.fighter.position.x-config.fighter.bodyWidth*config.fighter.vulnerability){t.states.walkLeft=false;t.states.walkRight=false;if(Math.floor(e*2)>0){t.fighter.punch()}else{t.fighter.kick()}}};t.update=function(){if(t.states.walkLeft){t.fighter.walkLeft()}if(t.states.walkRight){t.fighter.walkRight()}};t.destruct=function(){t.states.walkLeft=false;t.states.walkRight=false;t.states.jump=false;window.clearInterval(t.fighting)};t.construct()}var config={};config.frameRate=10;config.difficulty=3;config.startDelay=1500;config.endDelay=500;config.keys={punch:32,kick:13,walkLeft:37,walkRight:39,jump:38};config.arena={width:800,height:508,x:0,y:0};config.fighter={bodyWidth:100,width:320,height:320,x:0,y:160,stepLength:20,vulnerability:.5,damage:3};config.energy={width:320,height:20,x:42,y:62};config.images=[];config.images["arena"]={fileName:"assets/arena.gif",width:config.arena.width,height:config.arena.height,x:config.arena.x,y:config.arena.y};config.images["user"]={fileName:"assets/scorpion.gif",width:config.fighter.width,height:config.fighter.height,x:config.fighter.x,y:config.fighter.y};config.images["user"].frames={};config.images["user"].frames.idle=[{x:0*config.fighter.width,y:0*config.fighter.height},{x:1*config.fighter.width,y:0*config.fighter.height},{x:2*config.fighter.width,y:0*config.fighter.height},{x:3*config.fighter.width,y:0*config.fighter.height},{x:4*config.fighter.width,y:0*config.fighter.height},{x:5*config.fighter.width,y:0*config.fighter.height},{x:6*config.fighter.width,y:0*config.fighter.height}];config.images["user"].frames.walkLeft=[{x:0*config.fighter.width,y:1*config.fighter.height},{x:1*config.fighter.width,y:1*config.fighter.height},{x:2*config.fighter.width,y:1*config.fighter.height},{x:3*config.fighter.width,y:1*config.fighter.height},{x:4*config.fighter.width,y:1*config.fighter.height},{x:5*config.fighter.width,y:1*config.fighter.height},{x:6*config.fighter.width,y:1*config.fighter.height},{x:7*config.fighter.width,y:1*config.fighter.height},{x:8*config.fighter.width,y:1*config.fighter.height}];config.images["user"].frames.walkRight=[{x:0*config.fighter.width,y:2*config.fighter.height},{x:1*config.fighter.width,y:2*config.fighter.height},{x:2*config.fighter.width,y:2*config.fighter.height},{x:3*config.fighter.width,y:2*config.fighter.height},{x:4*config.fighter.width,y:2*config.fighter.height},{x:5*config.fighter.width,y:2*config.fighter.height},{x:6*config.fighter.width,y:2*config.fighter.height},{x:7*config.fighter.width,y:2*config.fighter.height},{x:8*config.fighter.width,y:2*config.fighter.height}];config.images["user"].frames.punch=[{x:1*config.fighter.width,y:3*config.fighter.height},{x:2*config.fighter.width,y:3*config.fighter.height}];config.images["user"].frames.kick=[{x:3*config.fighter.width,y:4*config.fighter.height},{x:4*config.fighter.width,y:4*config.fighter.height}];config.images["user"].frames.getHit=[{x:0*config.fighter.width,y:0*config.fighter.height},{x:1*config.fighter.width,y:5*config.fighter.height},{x:2*config.fighter.width,y:5*config.fighter.height},{x:3*config.fighter.width,y:5*config.fighter.height}];config.images["user"].frames.win=[{x:0*config.fighter.width,y:6*config.fighter.height},{x:1*config.fighter.width,y:6*config.fighter.height},{x:2*config.fighter.width,y:6*config.fighter.height},{x:3*config.fighter.width,y:6*config.fighter.height}];config.images["user"].frames.lose=[{x:0*config.fighter.width,y:7*config.fighter.height},{x:4*config.fighter.width,y:7*config.fighter.height},{x:5*config.fighter.width,y:7*config.fighter.height}];config.images["computer"]={fileName:"assets/sub-zero.gif",width:config.fighter.width,height:config.fighter.height,x:config.arena.width-config.fighter.width-config.fighter.x,y:config.fighter.y};config.images["computer"].frames={};config.images["computer"].frames.idle=[{x:11*config.fighter.width,y:0*config.fighter.height},{x:10*config.fighter.width,y:0*config.fighter.height},{x:9*config.fighter.width,y:0*config.fighter.height},{x:8*config.fighter.width,y:0*config.fighter.height},{x:7*config.fighter.width,y:0*config.fighter.height},{x:6*config.fighter.width,y:0*config.fighter.height},{x:5*config.fighter.width,y:0*config.fighter.height},{x:4*config.fighter.width,y:0*config.fighter.height},{x:3*config.fighter.width,y:0*config.fighter.height},{x:2*config.fighter.width,y:0*config.fighter.height},{x:1*config.fighter.width,y:0*config.fighter.height},{x:0*config.fighter.width,y:0*config.fighter.height}];config.images["computer"].frames.walkLeft=[{x:11*config.fighter.width,y:1*config.fighter.height},{x:10*config.fighter.width,y:1*config.fighter.height},{x:9*config.fighter.width,y:1*config.fighter.height},{x:8*config.fighter.width,y:1*config.fighter.height},{x:7*config.fighter.width,y:1*config.fighter.height},{x:6*config.fighter.width,y:1*config.fighter.height},{x:5*config.fighter.width,y:1*config.fighter.height},{x:4*config.fighter.width,y:1*config.fighter.height},{x:3*config.fighter.width,y:1*config.fighter.height}];config.images["computer"].frames.walkRight=[{x:11*config.fighter.width,y:2*config.fighter.height},{x:10*config.fighter.width,y:2*config.fighter.height},{x:9*config.fighter.width,y:2*config.fighter.height},{x:8*config.fighter.width,y:2*config.fighter.height},{x:7*config.fighter.width,y:2*config.fighter.height},{x:6*config.fighter.width,y:2*config.fighter.height},{x:5*config.fighter.width,y:2*config.fighter.height},{x:4*config.fighter.width,y:2*config.fighter.height},{x:3*config.fighter.width,y:2*config.fighter.height}];config.images["computer"].frames.punch=[{x:10*config.fighter.width,y:3*config.fighter.height},{x:9*config.fighter.width,y:3*config.fighter.height}];config.images["computer"].frames.kick=[{x:10*config.fighter.width,y:4*config.fighter.height},{x:8*config.fighter.width,y:4*config.fighter.height},{x:7*config.fighter.width,y:4*config.fighter.height},{x:6*config.fighter.width,y:4*config.fighter.height},{x:5*config.fighter.width,y:4*config.fighter.height},{x:4*config.fighter.width,y:4*config.fighter.height}];config.images["computer"].frames.getHit=[{x:11*config.fighter.width,y:0*config.fighter.height},{x:10*config.fighter.width,y:5*config.fighter.height},{x:9*config.fighter.width,y:5*config.fighter.height},{x:8*config.fighter.width,y:5*config.fighter.height}];config.images["computer"].frames.win=[{x:11*config.fighter.width,y:6*config.fighter.height},{x:10*config.fighter.width,y:6*config.fighter.height},{x:9*config.fighter.width,y:6*config.fighter.height},{x:8*config.fighter.width,y:6*config.fighter.height}];config.images["computer"].frames.lose=[{x:11*config.fighter.width,y:7*config.fighter.height},{x:7*config.fighter.width,y:7*config.fighter.height},{x:6*config.fighter.width,y:7*config.fighter.height}];config.images["userEnergyBar"]={fileName:"assets/energy-bar.gif",width:324,height:24,x:40,y:60};config.images["computerEnergyBar"]={fileName:"assets/energy-bar.gif",width:config.images["userEnergyBar"].width,height:config.images["userEnergyBar"].height,x:config.arena.width-config.images["userEnergyBar"].width-config.images["userEnergyBar"].x,y:config.images["userEnergyBar"].y};config.images["userEnergy"]={fileName:"assets/energy.gif",width:config.energy.width,height:config.energy.height,x:config.energy.x,y:config.energy.y};config.images["computerEnergy"]={fileName:"assets/energy.gif",width:config.energy.width,height:config.energy.height,x:config.arena.width-config.energy.width-config.energy.x,y:config.energy.y};config.images["userName"]={fileName:"assets/scorpion-name.gif",width:125,height:19,x:66,y:62};config.images["computerName"]={fileName:"assets/sub-zero-name.gif",width:config.images["userName"].width,height:config.images["userName"].height,x:config.arena.width-config.images["userName"].width-config.images["userName"].x,y:config.images["userName"].y};config.images["userWins"]={fileName:"assets/scorpion-wins.gif",width:300,height:36,x:250,y:112};config.images["computerWins"]={fileName:"assets/sub-zero-wins.gif",width:config.images["userWins"].width,height:config.images["userWins"].height,x:config.images["userWins"].x,y:config.images["userWins"].y};config.images["fight"]={fileName:"assets/fight.gif",width:302,height:80,x:249,y:150};config.sounds=[];config.sounds["fight"]={fileName:"assets/fight.mp3"};config.sounds["userWins"]={fileName:"assets/scorpion-wins.mp3"};config.sounds["computerWins"]={fileName:"assets/sub-zero-wins.mp3"};config.sounds["moan1"]={fileName:"assets/moan1.mp3"};config.sounds["moan2"]={fileName:"assets/moan2.mp3"};config.sounds["getPunched"]={fileName:"assets/getPunched.mp3"};config.sounds["getKicked"]={fileName:"assets/getKicked.mp3"};var game,images,sounds;document.addEventListener("DOMContentLoaded",function(){game=new Game})